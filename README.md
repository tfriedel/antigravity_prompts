# Antigravity Prompts Analysis

Reverse-engineered prompts and system analysis from Antigravity (Google's VS Code fork with AI capabilities).

## Overview

This repository contains extracted prompts and analysis of Antigravity's AI agent system, focusing on:

- **Context Compaction**: How the system manages token limits
- **Knowledge Items (KI)**: Persistent memory and knowledge distillation
- **Cortex Agent System**: Planning and execution architecture

## Directory Structure

```
antigravity_prompts/
├── prompts/                    # Raw extracted prompts from binary
│   ├── knowledge_items_raw.txt
│   ├── conversation_logs_raw.txt
│   ├── context_compaction_raw.txt
│   ├── system_instructions_raw.txt
│   ├── agent_modes_raw.txt
│   ├── browser_agent_raw.txt
│   ├── cortex_steps_raw.txt
│   ├── context_injection_raw.txt
│   ├── template_paths.txt
│   └── grpc_services.txt
│
├── analysis/                   # Written analysis and documentation
│   ├── knowledge_items_system.md
│   ├── context_compaction.md
│   └── cortex_agent_system.md
│
└── README.md
```

## Key Findings

### 1. Knowledge Items (KI) System

Antigravity uses a **Knowledge Items system** for persistent memory:

- **Distillation**: A separate KNOWLEDGE SUBAGENT processes conversations after they end
- **Structure**: Each KI is a directory with `metadata.json` and `artifacts/`
- **Operations**: Create, consolidate (merge), and delete KIs
- **Retrieval**: Semantic search for relevant KIs

See: [analysis/knowledge_items_system.md](analysis/knowledge_items_system.md)

### 2. Context Compaction

Multi-layered approach to managing context:

1. **KI Distillation** - Conversations → compact Knowledge Items
2. **Checkpoint Truncation** - Periodic checkpoints with truncation on overflow
3. **Trajectory Summaries** - Compact conversation representations
4. **LRU Cache** - Least Recently Used eviction for context items
5. **Context Refresh** - Re-evaluation on IDE actions/chat events

See: [analysis/context_compaction.md](analysis/context_compaction.md)

### 3. Cortex Agent System

Step-based execution architecture:

- **Planning Steps**: UserInput → PlannerResponse → FileBreakdown → BrainUpdate
- **Execution Steps**: ProposeCode, CodeAction, RunCommand, ViewCodeItem
- **Control Steps**: Checkpoint, TaskBoundary, Finish
- **Agent Modes**: READ-ONLY (propose) vs EDIT (direct changes)

See: [analysis/cortex_agent_system.md](analysis/cortex_agent_system.md)

## Source

All data extracted from:
```
Antigravity 1.104.0
Binary: resources/app/extensions/antigravity/bin/language_server_windows_x64.exe
```

## Extraction Method

Prompts were extracted using `strings` command on the language server binary:

```bash
strings language_server_windows_x64.exe | grep -iE "<pattern>"
```

## Notable Prompts

### Knowledge Subagent Description
```
KIs contain curated knowledge on specific topics. Individual KIs can be updated
or expanded over multiple conversations. They are generated by a separate
KNOWLEDGE SUBAGENT that reads the conversations and then distills the information
into new KIs or updates existing KIs as appropriate.
```

### Code Item Tracking
```
The following is an important list of code items that you have previously
edited and viewed. Study this information carefully and only re-view code
items if it is absolutely required to proceed.
```

### Context Truncation
```
no checkpoint found, truncating conversation to step index %d.
current tokens: %d, token limit: %d
```

## Template Locations

Internal template paths found:
```
google3/third_party/jetski/prompt/template_provider/templates/
├── system_prompts/
│   ├── notify_user_tool.tmpl
│   ├── conversation_logs.tmpl
│   ├── ephemeral_message.tmpl
│   └── mode_descriptions.tmpl
└── helpers/
```

## Disclaimer

This is a reverse-engineering effort for educational purposes. The extracted content is from a compiled binary and may be incomplete or partially accurate.

## License

Analysis and documentation are provided as-is for research purposes.
