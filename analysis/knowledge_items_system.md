# Knowledge Items (KI) System Analysis

## Overview

Antigravity uses a **Knowledge Items (KI) system** as its primary mechanism for persistent memory and context compaction. This system allows the AI to "remember" important information across conversation sessions without maintaining full conversation history.

## What Are Knowledge Items?

From extracted prompts:

```
Knowledge Items (KIs) are collections of related artifacts and metadata on a
specific topic, stored in {{ KnowledgeDirectoryPath }}.

Each KI in {{ KnowledgeDirectoryPath }} contains:
[structure details]

KIs contain curated knowledge on specific topics. Individual KIs can be updated
or expanded over multiple conversations. They are generated by a separate
KNOWLEDGE SUBAGENT that reads the conversations and then distills the information
into new KIs or updates existing KIs as appropriate.
```

## KI Structure

Each KI is a **directory** containing:

| File/Directory | Purpose |
|----------------|---------|
| `metadata.json` | KI metadata (scope, title, descriptions) |
| `artifacts/` | Directory of generated artifacts |

### Configuration Parameters

- `maxArtifactsPerKI` - Limits artifacts per KI
- `MaxKnowledgeItems` - Limits total number of KIs

## The Distillation Process

**Key Insight**: KIs are NOT created during conversation - they're created **after** by a separate **KNOWLEDGE SUBAGENT**.

### Process Flow

1. **Conversation Ends** - User completes a conversation session
2. **Knowledge Subagent Activation** - Separate agent analyzes the conversation
3. **Distillation** - Extracts key insights, decisions, code patterns, learnings
4. **KI Generation/Update** - Either creates new KI or updates existing ones

## KI Lifecycle Operations

### 1. Generation - Create New KIs

Triggers:
```
- The topic is sufficiently distinct from existing KIs
- No existing KI covers this specific area
```

### 2. Consolidation - Merge KIs

Triggers:
```
- Multiple KIs covering the same or heavily overlapping topics
- One or more existing KIs that relate to new insights from the current conversation
- Related information scattered across several KIs
```

Workflow:
```
1. Merge content from all related existing KIs AND new findings from
   this conversation into a single comprehensive KI
2. [Process merged content]
3. Delete redundant KI directories using delete_knowledge
```

### 3. Deletion - Remove KIs

Triggers:
```
- Information is outdated or superseded by newer KIs
- KIs are no longer relevant to the codebase
```

Action:
```
Use the delete_knowledge tool to remove deprecated files or KI directories
```

## KI Retrieval Workflow

When the agent needs knowledge during a conversation:

```
1. **Search for relevant KIs**: Use [semantic_search] on the knowledge
   directory with a semantic search query describing what you are looking for.

2. **Review KI metadata**: Use [view_file] to read metadata.json and
   understand the KI's scope

3. **Explore relevant artifacts**: Use [list_dir] and [view_file] to
   examine artifacts within the KI
```

### Available Tools

| Tool | Purpose |
|------|---------|
| `semantic_search` | LLM-based relevance evaluation of KIs |
| `list_dir` | Directory listing for file/name patterns |
| `view_file` | Read KI contents |
| `write_to_file` | Create/update KI artifacts |
| `replace_file_content` | Modify existing artifacts |
| `delete_knowledge` | Remove KI directories |
| `read_knowledge_base_item` | Read a specific KI |

## Design Principles

### 1. KIs are Starting Points, Not Ground Truth

- They provide curated summaries, not complete records
- For full details, users should read the original conversation logs

### 2. Semantic Search First

- Always search KIs before reading conversation logs
- Only access raw logs when KIs are insufficient

### 3. Continuous Maintenance

- KIs are living documents that evolve
- Old/redundant KIs are actively deleted
- Related KIs are merged to reduce fragmentation

### 4. Artifacts Preserve Important Outputs

Types of artifacts:
- Code snippets
- Architecture documentation
- Decision records
- Important information to remember

Location: `<KI>/artifacts/`

## Integration with Conversation System

The KI system integrates with the broader context management:

1. **At Conversation Start**: Agent receives KI summaries
2. **During Conversation**: Agent can search/read KIs as needed
3. **After Conversation**: Knowledge Subagent distills new KIs

## Example Operations

### Deletion
```
delete_knowledge("oauth_implementation")
delete_knowledge("auth_middleware")
```

### Search
```
semantic_search("authentication patterns")
```

## Key Takeaways

1. **Separation of Concerns**: Knowledge distillation is a post-conversation process handled by a separate subagent
2. **Structured Storage**: KIs follow a consistent directory structure with metadata
3. **Active Maintenance**: The system actively consolidates and cleans up KIs
4. **Semantic Access**: KIs are retrieved via semantic search, not just file browsing
5. **Token Efficiency**: Distilled KIs are much smaller than full conversation logs

## Source

Extracted from: `language_server_windows_x64.exe`
Binary path: `resources/app/extensions/antigravity/bin/`
